```diff
- AS OF 2021 THIS SCRIPT IS NO LONGER FUNCTIONAL AND WILL NOT BE UPDATED

- Somewhere in 2021 Microsoft has changed the server from which settings JSON file was downloaded.
- I was not able to trace the correct server due to limited time.
- Later, they abandoned Xbox App and switched to new Xbox Companion App which used different settings.
- Somewhere in 2023 they switched the app again to Xbox Gaming App.
- This script worked only for old Xbox App which supported Xbox One/One S/One X only.
- Xbox Series X/Series S were never supported as they used different apps mentioned above.

- As I no longer use Xbox I will not make any updates to this script
- (Original Xbox App is not available anyway)
- I will keep the script here for historical purposes only.
```


# Xbox App Mod Script

*Script lets you modify standard Windows 10 Xbox App streaming to PC settings*

## General

This script (written in PowerShell) does the following:

1. Modifies the Windows hosts file to prevent downloading latest version of Xbox App config by Xbox App (makes a backup first)
2. Modifies the actual Xbox App config file (makes a backup first)
3. Launches Xbox App and waits for the process to end (***you can actually start playing at this step :)*** )
4. Once Xbox App is closed, reverts the changes of hosts file and config file (by restoring backup files)

Xbox App config file (*settings.json*) values are modified within Very High profile settings (*GAME_STREAMING_VERY_HIGH_QUALITY_SETTINGS*).

Script uses its own config file (**config.xml**) so you may customize its values which will then be applied to hosts file and Xbox App config file.

## Prerequisites

In order to run this script you need to do the following first:

- Change Windows script Execution Policy:
 1. Open PowerShell **as Administrator**
 2. Type `Set-ExecutionPolicy Unrestricted` and confirm with `Y`
- Make sure that you are logged into your Xbox Live/Microsoft account in the Xbox App and have used streaming to PC at least once
- Script is started by `start.bat` - **remember to run it as Administrator!** (Otherwise script will not be able to modify hosts file. More about it you can find within **Usage** section below)

## Config file

First please take a look at **config.xml** file. In the `<settings>` section you have four settings:

- `<hostsblocker>127.0.0.1 settings.data.microsoft.com</hostsblocker>`
This one defines the actual hosts entry that prevents Xbox App from downloading new config. There is no need to modify it as it currently works. If Microsoft changes the server from which settings are downloaded and I will not update it yet, feel free to modify it by replacing `settings.data.microsoft.com` with something else :)

- `<quality>70</quality>`
General "quality" of the stream. The actual value in the Xbox App config file has another six zeros (so it's 70000000 instead of 70) but it does not match the bitrate so I don't think it's used to control it. I'd like to think of it as of a "percentage of quality" as it doesn't work over 99 anyway :) Suggested max is 70 - above that value bitrate is starting to exceed 35-40 mbps which causes compression errors and stuttering.

- `<resolution>1080</resolution>`
Resolution of the stream - you can use 480, 720 or 1080. Unfortunately 1440 and 2160 do not work and Xbox reverts back to lower profiles.

- `<framerate>60</framerate>`
Framerate can be set to 30 or 60. In general I suggest 30 for Xbox 360 games and 60 for Xbox One games but please check what is the default FPS cap for your game first. Even if game is capped at 30 FPS, Xbox is streaming 60 FPS by default, pumping bitrate twice as high (basically sending two identical frames for every frame generated by the console). Changing to 30 lets you have the same framerate with better quality.


## Usage

1. Modify `config.xml` with desired values
2. Run `start.bat` as Administrator

**Do not run the `xboxappmod.ps1` directly**. Instead run the `start.bat` which checks the administrator permissions first and then runs the script on its own. **Remember to run `start.bat` as Administrator**, otherwise it won't be able to modify hosts file.

You can create a shortcut to `start.bat` and make it always run with Administrator permissions.

After running the script, Xbox App will start automatically. You can play a game then :) After finishing playing close the Xbox App and the script will finish automatically after a while. **Do not close the script manually or it will not restore backups of hosts and settings file!**

Script creates two files: `hosts.bak` and `settings.json.bak`. These are backups of modified files. Do not remove them manually while the script is running or it will not be able to restore backups.

Most of errors should be handled by the script, but if any unhandled error occurs, a file called `lasterror.txt` will be created. You can view it to check what went wrong. 

If the script does not start, doublecheck the **Prerequisites** section.

---

Please let me know if you find mistakes, bugs or errors.
You can post issues here: https://github.com/kaczorws/xboxappmod/issues
